module.exports=[40331,a=>{"use strict";var b=a.i(87924),c=a.i(50944),d=a.i(72131),e=a.i(67594);function f({contentId:a,contentTitle:c,pricePerMinute:f,videoUrl:g,onStop:h}){let i,[j,k]=(0,d.useState)(!1),[l,m]=(0,d.useState)(0),[n,o]=(0,d.useState)(0),[p,q]=(0,d.useState)(null),[r,s]=(0,d.useState)(null),t=(0,d.useRef)(null),u=(0,d.useRef)(null);async function v(){let b=await (0,e.getWalletConnect)();if(!b.isWalletConnected())return void s("Please connect your wallet first");s(null),k(!0);try{let c=b.getConnectedAddress();if(!c)throw Error("Wallet not connected");let d=await (0,e.getBilling)(),g=await d.startSession({contentId:a,userId:c,ratePerMinute:f});q(g.sessionId),t.current=setInterval(()=>{m(a=>a+1)},1e3),u.current=setInterval(async()=>{try{let a=await (0,e.getBilling)(),c=b.getWalletConnector();await a.sendTick(g.sessionId,{signer:c});let d=Math.floor(l/60)+1;o(d*f)}catch(a){console.error("Tick error:",a),s(a.message||"Billing error")}},6e4)}catch(a){s(a.message||"Failed to start session"),k(!1)}}async function w(){if(k(!1),t.current&&(clearInterval(t.current),t.current=null),u.current&&(clearInterval(u.current),u.current=null),p)try{let a=await (0,e.getBilling)();await a.stopSession(p),h?.(p,n,l)}catch(a){s(a.message||"Failed to stop session")}}(0,d.useEffect)(()=>()=>{t.current&&clearInterval(t.current),u.current&&clearInterval(u.current),p&&(0,e.getBilling)().then(a=>a.stopSession(p).catch(console.error))},[p]);let x=Math.floor(l/60)*f;return(0,b.jsxs)("div",{className:"flex flex-col gap-4 rounded-lg border border-zinc-200 bg-white p-6 dark:border-zinc-800 dark:bg-zinc-900",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100",children:c}),(0,b.jsxs)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:["€",f.toFixed(2),"/min"]})]}),r&&(0,b.jsx)("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-600 dark:bg-red-900/20 dark:text-red-400",children:r}),(0,b.jsx)("div",{className:"aspect-video w-full rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center",children:g?(0,b.jsx)("video",{src:g,controls:j,className:"w-full h-full rounded-lg",onPlay:()=>!j&&v(),onPause:()=>j&&w()}):(0,b.jsxs)("div",{className:"text-center text-zinc-500 dark:text-zinc-400",children:[(0,b.jsx)("p",{className:"text-lg font-medium",children:"Video Player"}),(0,b.jsxs)("p",{className:"text-sm mt-2",children:["Content: ",c]})]})}),j&&(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Duration"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:(i=Math.floor(l/60),`${i.toString().padStart(2,"0")}:${(l%60).toString().padStart(2,"0")}`)})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end",children:[(0,b.jsx)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Charged"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:["€",x.toFixed(2)]})]})]}),(0,b.jsx)("div",{className:"flex gap-2",children:j?(0,b.jsx)("button",{onClick:w,className:"flex-1 rounded-lg bg-red-500 px-6 py-3 font-medium text-white transition-colors hover:bg-red-600",children:"Stop"}):(0,b.jsx)("button",{onClick:v,className:"flex-1 rounded-lg bg-green-500 px-6 py-3 font-medium text-white transition-colors hover:bg-green-600",children:"Start Watching"})})]})}var g=a.i(47258);function h(){let a=(0,c.useSearchParams)(),h=(0,c.useRouter)(),[i,j]=(0,d.useState)(!1),k=a.get("contentId")||"1",l=a.get("title")||"Sample Content",m=parseFloat(a.get("price")||"0.02");return((0,d.useEffect)(()=>{!async function(){try{let a=(await (0,e.getWalletConnect)()).isWalletConnected();j(a),a||h.push("/")}catch(a){console.error("Error checking wallet:",a)}}()},[h]),i)?(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-zinc-900 dark:to-zinc-800",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsx)(f,{contentId:k,contentTitle:l,pricePerMinute:m,onStop:function(a,b,c){h.push(`/summary?sessionId=${a}&charge=${b}&duration=${c}&title=${encodeURIComponent(l)}`)}})})}):(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-zinc-900 dark:to-zinc-800",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-800 dark:bg-red-900/20",children:[(0,b.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:"Please connect your wallet first."}),(0,b.jsx)(g.default,{onConnect:()=>j(!0),onDisconnect:()=>j(!1)})]})})})}function i(){return(0,b.jsx)(d.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}),children:(0,b.jsx)(h,{})})}a.s(["default",()=>i],40331)}];

//# sourceMappingURL=app_player_page_tsx_bf859fb6._.js.map