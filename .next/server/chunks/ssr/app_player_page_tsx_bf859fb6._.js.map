{"version":3,"sources":["turbopack:///[project]/app/player/page.tsx","turbopack:///[project]/components/VideoPlayer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useSearchParams, useRouter } from 'next/navigation';\r\nimport { useEffect, useState, Suspense } from 'react';\r\nimport VideoPlayer from '@/components/VideoPlayer';\r\nimport WalletConnect from '@/components/WalletConnect';\r\nimport { getWalletConnect } from '@/lib/sdk';\r\n\r\nfunction PlayerContent() {\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n  const [isWalletConnected, setIsWalletConnected] = useState(false);\r\n\r\n  const contentId = searchParams.get('contentId') || '1';\r\n  const contentTitle = searchParams.get('title') || 'Sample Content';\r\n  const pricePerMinute = parseFloat(searchParams.get('price') || '0.02');\r\n\r\n  useEffect(() => {\r\n    // Check wallet connection\r\n    async function checkWallet() {\r\n      try {\r\n        const wc = await getWalletConnect();\r\n        const connected = wc.isWalletConnected();\r\n        setIsWalletConnected(connected);\r\n\r\n        if (!connected) {\r\n          // Redirect to home if wallet not connected\r\n          router.push('/');\r\n        }\r\n      } catch (err) {\r\n        console.error('Error checking wallet:', err);\r\n      }\r\n    }\r\n    checkWallet();\r\n  }, [router]);\r\n\r\n  function handleStop(sessionId: string, totalCharge: number, duration: number) {\r\n    // Navigate to summary page\r\n    router.push(\r\n      `/summary?sessionId=${sessionId}&charge=${totalCharge}&duration=${duration}&title=${encodeURIComponent(contentTitle)}`\r\n    );\r\n  }\r\n\r\n  if (!isWalletConnected) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-zinc-900 dark:to-zinc-800\">\r\n        <div className=\"container mx-auto px-4 py-8\">\r\n          <div className=\"rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-800 dark:bg-red-900/20\">\r\n            <p className=\"text-sm text-red-800 dark:text-red-200\">\r\n              Please connect your wallet first.\r\n            </p>\r\n            <WalletConnect\r\n              onConnect={() => setIsWalletConnected(true)}\r\n              onDisconnect={() => setIsWalletConnected(false)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-zinc-900 dark:to-zinc-800\">\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <VideoPlayer\r\n          contentId={contentId}\r\n          contentTitle={contentTitle}\r\n          pricePerMinute={pricePerMinute}\r\n          onStop={handleStop}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function PlayerPage() {\r\n  return (\r\n    <Suspense fallback={<div className=\"min-h-screen flex items-center justify-center\">Loading...</div>}>\r\n      <PlayerContent />\r\n    </Suspense>\r\n  );\r\n}\r\n\r\n","'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { getBilling, getWalletConnect } from '@/lib/sdk';\r\nimport { appConfig } from '@/lib/config';\r\n\r\ninterface VideoPlayerProps {\r\n  contentId: string;\r\n  contentTitle: string;\r\n  pricePerMinute: number;\r\n  videoUrl?: string;\r\n  onStop?: (sessionId: string, totalCharge: number, duration: number) => void;\r\n}\r\n\r\nexport default function VideoPlayer({\r\n  contentId,\r\n  contentTitle,\r\n  pricePerMinute,\r\n  videoUrl,\r\n  onStop,\r\n}: VideoPlayerProps) {\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [duration, setDuration] = useState(0); // in seconds\r\n  const [totalCharge, setTotalCharge] = useState(0);\r\n  const [sessionId, setSessionId] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const tickIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      // Cleanup on unmount\r\n      if (intervalRef.current) clearInterval(intervalRef.current);\r\n      if (tickIntervalRef.current) clearInterval(tickIntervalRef.current);\r\n      if (sessionId) {\r\n        getBilling().then(b => b.stopSession(sessionId).catch(console.error));\r\n      }\r\n    };\r\n  }, [sessionId]);\r\n\r\n  async function handleStart() {\r\n    const wc = await getWalletConnect();\r\n    if (!wc.isWalletConnected()) {\r\n      setError('Please connect your wallet first');\r\n      return;\r\n    }\r\n\r\n    setError(null);\r\n    setIsPlaying(true);\r\n\r\n    try {\r\n      // Start session\r\n      const userAddress = wc.getConnectedAddress();\r\n      if (!userAddress) {\r\n        throw new Error('Wallet not connected');\r\n      }\r\n\r\n      const b = await getBilling();\r\n      const session = await b.startSession({\r\n        contentId,\r\n        userId: userAddress,\r\n        ratePerMinute: pricePerMinute,\r\n      }) as any;\r\n\r\n      setSessionId(session.sessionId);\r\n\r\n      // Start timer\r\n      intervalRef.current = setInterval(() => {\r\n        setDuration((prev) => prev + 1);\r\n      }, 1000);\r\n\r\n      // Send tick every minute (60 seconds)\r\n      tickIntervalRef.current = setInterval(async () => {\r\n        try {\r\n          const billingModule = await getBilling();\r\n          const signer = wc.getWalletConnector();\r\n          \r\n          await billingModule.sendTick(session.sessionId, {\r\n            signer,\r\n          });\r\n\r\n          // Update charge\r\n          const minutes = Math.floor(duration / 60) + 1;\r\n          setTotalCharge(minutes * pricePerMinute);\r\n        } catch (err: any) {\r\n          console.error('Tick error:', err);\r\n          setError(err.message || 'Billing error');\r\n        }\r\n      }, 60000); // Every minute\r\n    } catch (err: any) {\r\n      setError(err.message || 'Failed to start session');\r\n      setIsPlaying(false);\r\n    }\r\n  }\r\n\r\n  async function handleStop() {\r\n    setIsPlaying(false);\r\n\r\n    if (intervalRef.current) {\r\n      clearInterval(intervalRef.current);\r\n      intervalRef.current = null;\r\n    }\r\n\r\n    if (tickIntervalRef.current) {\r\n      clearInterval(tickIntervalRef.current);\r\n      tickIntervalRef.current = null;\r\n    }\r\n\r\n    if (sessionId) {\r\n      try {\r\n        const b = await getBilling();\r\n        await b.stopSession(sessionId);\r\n        onStop?.(sessionId, totalCharge, duration);\r\n      } catch (err: any) {\r\n        setError(err.message || 'Failed to stop session');\r\n      }\r\n    }\r\n  }\r\n\r\n  function formatTime(seconds: number): string {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n  }\r\n\r\n  const minutes = Math.floor(duration / 60);\r\n  const currentCharge = minutes * pricePerMinute;\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4 rounded-lg border border-zinc-200 bg-white p-6 dark:border-zinc-800 dark:bg-zinc-900\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h2 className=\"text-xl font-semibold text-zinc-900 dark:text-zinc-100\">\r\n          {contentTitle}\r\n        </h2>\r\n        <span className=\"text-sm text-zinc-600 dark:text-zinc-400\">\r\n          €{pricePerMinute.toFixed(2)}/min\r\n        </span>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"rounded-lg bg-red-50 p-3 text-sm text-red-600 dark:bg-red-900/20 dark:text-red-400\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* Video Player Placeholder */}\r\n      <div className=\"aspect-video w-full rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center\">\r\n        {videoUrl ? (\r\n          <video\r\n            src={videoUrl}\r\n            controls={isPlaying}\r\n            className=\"w-full h-full rounded-lg\"\r\n            onPlay={() => !isPlaying && handleStart()}\r\n            onPause={() => isPlaying && handleStop()}\r\n          />\r\n        ) : (\r\n          <div className=\"text-center text-zinc-500 dark:text-zinc-400\">\r\n            <p className=\"text-lg font-medium\">Video Player</p>\r\n            <p className=\"text-sm mt-2\">Content: {contentTitle}</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Session Info */}\r\n      {isPlaying && (\r\n        <div className=\"flex items-center justify-between rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20\">\r\n          <div className=\"flex flex-col\">\r\n            <span className=\"text-sm text-zinc-600 dark:text-zinc-400\">Duration</span>\r\n            <span className=\"text-2xl font-bold text-zinc-900 dark:text-zinc-100\">\r\n              {formatTime(duration)}\r\n            </span>\r\n          </div>\r\n          <div className=\"flex flex-col items-end\">\r\n            <span className=\"text-sm text-zinc-600 dark:text-zinc-400\">Charged</span>\r\n            <span className=\"text-2xl font-bold text-zinc-900 dark:text-zinc-100\">\r\n              €{currentCharge.toFixed(2)}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Controls */}\r\n      <div className=\"flex gap-2\">\r\n        {!isPlaying ? (\r\n          <button\r\n            onClick={handleStart}\r\n            className=\"flex-1 rounded-lg bg-green-500 px-6 py-3 font-medium text-white transition-colors hover:bg-green-600\"\r\n          >\r\n            Start Watching\r\n          </button>\r\n        ) : (\r\n          <button\r\n            onClick={handleStop}\r\n            className=\"flex-1 rounded-lg bg-red-500 px-6 py-3 font-medium text-white transition-colors hover:bg-red-600\"\r\n          >\r\n            Stop\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}