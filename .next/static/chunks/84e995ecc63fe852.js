(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,41406,e=>{"use strict";var t=e.i(43476),n=e.i(18566),r=e.i(71645),s=e.i(74959);function l({contentId:e,contentTitle:n,pricePerMinute:l,videoUrl:a,onStop:c}){let i,[o,d]=(0,r.useState)(!1),[u,x]=(0,r.useState)(0),[m,g]=(0,r.useState)(0),[h,f]=(0,r.useState)(null),[p,b]=(0,r.useState)(null),j=(0,r.useRef)(null),v=(0,r.useRef)(null);async function N(){let t=await (0,s.getWalletConnect)();if(!t.isWalletConnected())return void b("Please connect your wallet first");b(null),d(!0);try{let n=t.getConnectedAddress();if(!n)throw Error("Wallet not connected");let r=await (0,s.getBilling)(),a=await r.startSession({contentId:e,userId:n,ratePerMinute:l});f(a.sessionId),j.current=setInterval(()=>{x(e=>e+1)},1e3),v.current=setInterval(async()=>{try{let e=await (0,s.getBilling)(),n=t.getWalletConnector();await e.sendTick(a.sessionId,{signer:n});let r=Math.floor(u/60)+1;g(r*l)}catch(e){console.error("Tick error:",e),b(e.message||"Billing error")}},6e4)}catch(e){b(e.message||"Failed to start session"),d(!1)}}async function k(){if(d(!1),j.current&&(clearInterval(j.current),j.current=null),v.current&&(clearInterval(v.current),v.current=null),h)try{let e=await (0,s.getBilling)();await e.stopSession(h),c?.(h,m,u)}catch(e){b(e.message||"Failed to stop session")}}(0,r.useEffect)(()=>()=>{j.current&&clearInterval(j.current),v.current&&clearInterval(v.current),h&&(0,s.getBilling)().then(e=>e.stopSession(h).catch(console.error))},[h]);let y=Math.floor(u/60)*l;return(0,t.jsxs)("div",{className:"flex flex-col gap-4 rounded-lg border border-zinc-200 bg-white p-6 dark:border-zinc-800 dark:bg-zinc-900",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100",children:n}),(0,t.jsxs)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:["€",l.toFixed(2),"/min"]})]}),p&&(0,t.jsx)("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-600 dark:bg-red-900/20 dark:text-red-400",children:p}),(0,t.jsx)("div",{className:"aspect-video w-full rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center",children:a?(0,t.jsx)("video",{src:a,controls:o,className:"w-full h-full rounded-lg",onPlay:()=>!o&&N(),onPause:()=>o&&k()}):(0,t.jsxs)("div",{className:"text-center text-zinc-500 dark:text-zinc-400",children:[(0,t.jsx)("p",{className:"text-lg font-medium",children:"Video Player"}),(0,t.jsxs)("p",{className:"text-sm mt-2",children:["Content: ",n]})]})}),o&&(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Duration"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:(i=Math.floor(u/60),`${i.toString().padStart(2,"0")}:${(u%60).toString().padStart(2,"0")}`)})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[(0,t.jsx)("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Charged"}),(0,t.jsxs)("span",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100",children:["€",y.toFixed(2)]})]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:o?(0,t.jsx)("button",{onClick:k,className:"flex-1 rounded-lg bg-red-500 px-6 py-3 font-medium text-white transition-colors hover:bg-red-600",children:"Stop"}):(0,t.jsx)("button",{onClick:N,className:"flex-1 rounded-lg bg-green-500 px-6 py-3 font-medium text-white transition-colors hover:bg-green-600",children:"Start Watching"})})]})}var a=e.i(15884);function c(){let e=(0,n.useSearchParams)(),c=(0,n.useRouter)(),[i,o]=(0,r.useState)(!1),d=e.get("contentId")||"1",u=e.get("title")||"Sample Content",x=parseFloat(e.get("price")||"0.02");return((0,r.useEffect)(()=>{!async function(){try{let e=(await (0,s.getWalletConnect)()).isWalletConnected();o(e),e||c.push("/")}catch(e){console.error("Error checking wallet:",e)}}()},[c]),i)?(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-zinc-900 dark:to-zinc-800",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(l,{contentId:d,contentTitle:u,pricePerMinute:x,onStop:function(e,t,n){c.push(`/summary?sessionId=${e}&charge=${t}&duration=${n}&title=${encodeURIComponent(u)}`)}})})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-zinc-900 dark:to-zinc-800",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-800 dark:bg-red-900/20",children:[(0,t.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:"Please connect your wallet first."}),(0,t.jsx)(a.default,{onConnect:()=>o(!0),onDisconnect:()=>o(!1)})]})})})}function i(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}),children:(0,t.jsx)(c,{})})}e.s(["default",()=>i],41406)}]);